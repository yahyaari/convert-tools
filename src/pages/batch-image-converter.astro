---
import BaseLayout from "../layouts/BaseLayout.astro";
import SITE from "../consts";

const pagePath = "/batch-image-converter";
const pageUrl = new URL(pagePath, SITE.url).toString();
const homeUrl = new URL("/", SITE.url).toString();

// ‚úÖ Client script URL
import batchClientUrl from "../scripts/batch-image-converter-client.js?url";
---

<BaseLayout
    title="Saku Batch Image Converter ‚Äì Toplu G√∂rsel D√∂n√º≈üt√ºrme (PNG/JPG/WebP/HEIC)"
    description="Birden √ßok g√∂rseli tek seferde d√∂n√º≈üt√ºr ve ZIP olarak indir. PNG/JPG/WebP + HEIC/HEIF + JFIF destekli. Her ≈üey tarayƒ±cƒ± i√ßinde, upload yok."
    canonical={pagePath}
    lang="tr"
    ogImage="/og/og-batch-image-converter.png"
    jsonLd={[
        // WebPage
        {
            "@type": "WebPage",
            "@id": `${pageUrl}#webpage`,
            url: pageUrl,
            name: "Saku Batch Image Converter ‚Äì Toplu G√∂rsel D√∂n√º≈üt√ºrme",
            alternateName: [
                "Saku Batch Converter",
                "Toplu g√∂rsel d√∂n√º≈üt√ºr√ºc√º",
                "Batch image converter",
                "Toplu PNG d√∂n√º≈üt√ºr√ºc√º",
                "Toplu JPG d√∂n√º≈üt√ºr√ºc√º",
                "Toplu WebP d√∂n√º≈üt√ºr√ºc√º",
                "HEIC d√∂n√º≈üt√ºr√ºc√º",
                "JFIF d√∂n√º≈üt√ºr√ºc√º",
            ],
            inLanguage: ["tr", "en"],
            isPartOf: { "@id": `${SITE.url}/#website` },
            about: { "@id": `${SITE.url}/#organization` },
            description:
                "Birden √ßok g√∂rseli aynƒ± anda PNG/JPG/WebP formatƒ±na d√∂n√º≈üt√ºr√ºr ve tek ZIP dosyasƒ± olarak indirir. T√ºm i≈ülem tarayƒ±cƒ± i√ßinde yapƒ±lƒ±r, upload yok.",
            primaryImageOfPage: {
                "@type": "ImageObject",
                url: new URL(
                    "/og/og-batch-image-converter.png",
                    SITE.url,
                ).toString(),
                width: 1200,
                height: 630,
            },
            mainEntity: { "@id": `${pageUrl}#app` },
        },

        // SoftwareApplication
        {
            "@type": "SoftwareApplication",
            "@id": `${pageUrl}#app`,
            name: "Saku Batch Image Converter",
            applicationCategory: "MultimediaApplication",
            operatingSystem: "Web",
            url: pageUrl,
            inLanguage: ["tr", "en"],
            isAccessibleForFree: true,
            offers: { "@type": "Offer", price: "0", priceCurrency: "TRY" },
            publisher: { "@id": `${SITE.url}/#organization` },
            isPartOf: { "@id": `${SITE.url}/#website` },
            description:
                "Toplu g√∂rsel d√∂n√º≈üt√ºr√ºc√º: √áoklu dosya se√ß, hedef formatƒ± belirle, tek ZIP indir. ƒ∞≈ülem tarayƒ±cƒ±da, dosyalar sunucuya y√ºklenmez.",
        },

        // FAQPage
        {
            "@type": "FAQPage",
            "@id": `${pageUrl}#faq`,
            url: pageUrl,
            inLanguage: "tr",
            mainEntity: [
                {
                    "@type": "Question",
                    name: "Dosyalarƒ±m sunucuya y√ºkleniyor mu?",
                    acceptedAnswer: {
                        "@type": "Answer",
                        text: "Hayƒ±r. T√ºm i≈ülemler tarayƒ±cƒ±nƒ±zda ger√ßekle≈üir, dosyalarƒ±nƒ±z sunucuya y√ºklenmez.",
                    },
                },
                {
                    "@type": "Question",
                    name: "Hangi formatlar destekleniyor?",
                    acceptedAnswer: {
                        "@type": "Answer",
                        text: "PNG, JPG, WebP desteklenir. HEIC/HEIF ve JFIF dosyalarƒ± da √ßoƒüu durumda d√∂n√º≈üt√ºr√ºlebilir.",
                    },
                },
                {
                    "@type": "Question",
                    name: "Sonu√ßlarƒ± nasƒ±l indiriyorum?",
                    acceptedAnswer: {
                        "@type": "Answer",
                        text: "D√∂n√º≈üt√ºrme bitince t√ºm √ßƒ±ktƒ±lar tek ZIP dosyasƒ± olarak indirilir.",
                    },
                },
            ],
        },

        // Breadcrumb
        {
            "@type": "BreadcrumbList",
            "@id": `${pageUrl}#breadcrumb`,
            itemListElement: [
                {
                    "@type": "ListItem",
                    position: 1,
                    name: "Anasayfa",
                    item: homeUrl,
                },
                {
                    "@type": "ListItem",
                    position: 2,
                    name: "Batch Image Converter",
                    item: pageUrl,
                },
            ],
        },
    ]}
/>

<header class="topbar">
    <div class="container topbar-inner">
        <nav class="nav nav-left" aria-label="Primary left">
            <a href="/" class="back-link" id="t-back">‚Üê Geri</a>
        </nav>

        <a class="brand" href="/" aria-label="Convert Tools">
            <span class="brand-mark">CT</span>
        </a>

        <div class="topbar-right">
            <nav class="nav nav-right" aria-label="Primary right">
                <a href="/#tools" id="t-navTools">Ara√ßlar</a>
            </nav>

            <div class="lang-switch" aria-label="Language switch">
                <button class="lang-btn" type="button" data-lang="tr">TR</button
                >
                <button class="lang-btn" type="button" data-lang="en">EN</button
                >
            </div>
        </div>
    </div>
</header>

<section class="page" id="top">
    <div class="container">
        <div class="mini-hero" id="miniHero">
            <span class="badge" id="t-badge">√úcretsiz & Sƒ±nƒ±rsƒ±z</span>

            <h1 class="page-title" id="t-title">Toplu G√∂rsel D√∂n√º≈üt√ºr√ºc√º</h1>

            <p class="page-subtitle muted" id="t-sub">
                Birden √ßok g√∂rseli se√ß, d√∂n√º≈üt√ºr ve tek ZIP olarak indir. Upload
                yok.
            </p>

            <div class="mini-features">
                <span id="t-f1">üóÇÔ∏è Toplu</span>
                <span id="t-f2">üîí Upload yok</span>
                <span id="t-f3">‚ö° Hƒ±zlƒ±</span>
            </div>
        </div>

        <div style="height:14px;"></div>

        <div class="panel">
            <div class="panel-head">
                <div class="breadcrumb">
                    <a href="/" id="t-bcHome">Anasayfa</a>
                    <span class="sep">‚Ä∫</span>
                    <span id="t-bcHere">Batch Image Converter</span>
                </div>
            </div>

            {/* ‚úÖ multiple dosya */}
            <input
                id="file"
                type="file"
                accept="image/*,.heic,.heif,.jfif,.svg"
                multiple
                hidden
            />

            <div class="upload-box" id="dropZone">
                <div class="upload-state is-idle">
                    <div class="upload-icon">‚¨á</div>
                    <div class="upload-text">
                        <label for="file" class="choose-link">
                            <b id="t-choose">Dosya se√ß</b>
                        </label>
                        <span id="idleHint">veya buraya s√ºr√ºkle.</span>
                    </div>
                </div>

                <div class="upload-state is-processing" hidden>
                    <div class="upload-spinner"></div>
                    <div class="upload-text">
                        <b id="t-processing">ƒ∞≈üleniyor‚Ä¶</b>
                    </div>
                </div>

                <div class="upload-state is-done" hidden>
                    <div class="upload-text">
                        <span id="t-ready">Hazƒ±r!</span>
                        <a href="#" id="uploadMore" class="choose-link">
                            <b id="t-uploadMore">Ba≈üka y√ºkle?</b>
                        </a>
                    </div>
                </div>
            </div>

            <div id="controls" class="controls" hidden>
                <div class="row">
                    <p class="muted" style="margin:0" id="statusLine">‚Äî</p>
                    <p class="muted" style="margin:0">
                        <span id="t-outFmt">√áƒ±ktƒ± formatƒ±:</span>
                    </p>
                </div>

                <div class="options">
                    <div class="opt">
                        <label class="muted" for="format" id="t-formatLabel"
                            >Format</label
                        >
                        <select id="format">
                            <option value="image/png">PNG</option>
                            <option value="image/jpeg">JPG</option>
                            <option value="image/webp">WebP</option>
                        </select>
                    </div>

                    <div class="opt opt-wide">
                        <label class="muted" id="t-qualityLabel">Kalite:</label>
                        <div class="quality-row">
                            <input
                                id="quality"
                                type="range"
                                min="40"
                                max="98"
                                value="92"
                            />
                            <span class="muted" id="qualityVal">92%</span>
                        </div>
                    </div>
                </div>

                <div class="btn-row">
                    <button id="convert" type="button">
                        D√∂n√º≈üt√ºr + ZIP indir
                    </button>
                    <button id="reset" type="button" class="ghost-btn">
                        Sƒ±fƒ±rla
                    </button>
                </div>

                <div class="progress-wrap" hidden id="progressWrap">
                    <div
                        class="muted"
                        style="display:flex;justify-content:space-between;gap:10px;"
                    >
                        <span id="progressText">‚Äî</span>
                        <span id="progressPct">0%</span>
                    </div>

                    <div class="progress-bar">
                        <div
                            class="progress-fill"
                            id="progressFill"
                            style="width:0%"
                        >
                        </div>
                    </div>
                </div>

                {/* ‚úÖ Preview + add card */}
                <div class="batch-preview-head">
                    <h3 class="batch-preview-title" id="t-previewTitle">
                        Se√ßilen Dosyalar
                    </h3>
                    <span class="muted" id="fileCount">0</span>
                </div>

                <div class="batch-preview-grid" id="previewGrid"></div>

                {/* ‚úÖ Error Box */}
                <div id="errorBox" class="batch-errorbox" hidden>
                    <div class="batch-errorbox-head">
                        <b id="errorHead">‚ö†Ô∏è D√∂n√º≈üt√ºr√ºlemeyen Dosyalar</b>
                        <span class="muted" id="errorCount">0</span>
                    </div>
                    <ul id="errorList" class="batch-errorlist"></ul>
                </div>

                <p id="result" class="muted" style="margin-top:10px;"></p>
            </div>
        </div>

        <div class="panel" style="margin-top:14px;">
            <section class="seo-text">
                <h2 id="t-seoH2">
                    Toplu G√∂rsel D√∂n√º≈üt√ºr√ºc√º (Saku Batch) Nasƒ±l √áalƒ±≈üƒ±r?
                </h2>

                <p class="seo-lead" id="t-seoLead">
                    Birden fazla g√∂rseli aynƒ± anda PNG/JPG/WebP formatƒ±na
                    d√∂n√º≈üt√ºr ve tek ZIP dosyasƒ± olarak indir. T√ºm i≈ülemler
                    tarayƒ±cƒ± i√ßinde ger√ßekle≈üir, upload yok.
                </p>

                <details class="seo-details">
                    <summary id="t-seoSummary">Detaylarƒ± g√∂ster</summary>
                    <div class="details-content">
                        <p id="t-seoP1">
                            Batch Image Converter sayesinde birden √ßok g√∂rsel
                            se√ßip tek seferde d√∂n√º≈üt√ºrebilirsiniz. √áƒ±ktƒ±larƒ± ZIP
                            i√ßinde indirerek zamandan tasarruf edersiniz.
                        </p>
                        <p id="t-seoP2">
                            HEIC/HEIF (iPhone) ve JFIF (WhatsApp) gibi formatlar
                            da desteklenir. Dosyalarƒ±nƒ±z sunucuya y√ºklenmez, her
                            ≈üey cihazƒ±nƒ±zda √ßalƒ±≈üƒ±r.
                        </p>
                    </div>
                </details>
            </section>
        </div>

        {/* ===== Styles (Preview + Error Box dahil) ===== */}
        <style is:global>
            .controls {
                margin-top: 14px;
            }
            .controls .row {
                display: flex;
                justify-content: space-between;
                gap: 10px;
                flex-wrap: wrap;
            }

            .options {
                display: grid;
                grid-template-columns: repeat(3, minmax(0, 1fr));
                gap: 12px;
                margin-top: 12px;
            }
            .opt {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }
            .opt-wide {
                grid-column: 1 / -1;
            }

            select {
                padding: 10px 12px;
                border-radius: 12px;
                border: 1px solid rgba(148, 163, 184, 0.45);
                background: rgba(255, 255, 255, 0.85);
                outline: none;
            }

            .quality-row {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .quality-row input[type="range"] {
                width: 100%;
            }

            .btn-row {
                display: flex;
                gap: 12px;
                flex-wrap: wrap;
                margin-top: 12px;
                align-items: center;
            }

            .ghost-btn {
                background: rgba(255, 255, 255, 0.75);
                color: #0f172a;
                border: 1px solid rgba(148, 163, 184, 0.45);
                box-shadow: 0 10px 26px rgba(15, 23, 42, 0.06);
            }
            .ghost-btn:hover {
                transform: none;
                filter: none;
            }

            .progress-wrap {
                margin-top: 12px;
            }
            .progress-bar {
                height: 10px;
                border-radius: 999px;
                background: rgba(148, 163, 184, 0.25);
                overflow: hidden;
                margin-top: 6px;
            }
            .progress-fill {
                height: 100%;
                border-radius: 999px;
                background: rgba(79, 70, 229, 0.8);
                width: 0%;
            }

            /* ===== Batch Preview (Scoped) ===== */
            .batch-preview-head {
                display: flex;
                align-items: baseline;
                justify-content: space-between;
                gap: 10px;
                margin-top: 14px;
            }
            .batch-preview-title {
                margin: 0;
                font-size: 16px;
            }

            .batch-preview-grid {
                margin-top: 10px;
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
                align-items: start;
            }

            @media (max-width: 880px) {
                .batch-preview-grid {
                    grid-template-columns: repeat(3, minmax(0, 1fr));
                }
                .options {
                    grid-template-columns: 1fr;
                }
            }
            @media (max-width: 520px) {
                .batch-preview-grid {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }
            }

            .batch-thumb {
                position: relative;
                border: 1px solid rgba(148, 163, 184, 0.35);
                border-radius: 14px;
                background: rgba(255, 255, 255, 0.7);
                overflow: hidden;
                box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
                width: 100%;
                max-width: 170px;
            }

            .batch-thumb img {
                width: 100%;
                height: 90px;
                object-fit: cover;
                display: block;
            }

            .batch-thumb-meta {
                padding: 6px 8px;
                display: flex;
                flex-direction: column;
                gap: 4px;
            }

            .batch-thumb-name {
                font-size: 11px;
                font-weight: 700;
                color: #0f172a;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

            .batch-thumb-sub {
                display: flex;
                justify-content: space-between;
                gap: 6px;
                align-items: center;
            }

            .batch-badge-mini {
                font-size: 10px;
                padding: 2px 7px;
                border-radius: 999px;
                border: 1px solid rgba(148, 163, 184, 0.35);
                background: rgba(255, 255, 255, 0.75);
                color: #0f172a;
            }

            .batch-badge-ok {
                border-color: rgba(34, 197, 94, 0.35);
            }
            .batch-badge-run {
                border-color: rgba(99, 102, 241, 0.35);
            }
            .batch-badge-err {
                border-color: rgba(244, 63, 94, 0.35);
            }

            .batch-remove {
                position: absolute;
                top: 6px;
                right: 6px;
                width: 24px;
                height: 24px;
                border-radius: 10px;
                border: 1px solid rgba(148, 163, 184, 0.35);
                color: rgb(204, 0, 0);
                background: rgba(255, 255, 255, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                user-select: none;
                font-size: 12px;
            }
            .batch-remove:hover {
                filter: brightness(0.95);
            }

            /* ‚úÖ + kart */
            .batch-add-card {
                width: 100%;
                max-width: 170px;
                height: 148px;
                border-radius: 14px;
                color: rgb(0, 180, 0);
                border: 1px dashed rgba(148, 163, 184, 0.55);
                background: rgba(255, 255, 255, 0.55);
                display: flex;
                flex-direction: column;
                gap: 8px;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 10px 24px rgba(15, 23, 42, 0.04);
            }
            .batch-add-card:hover {
                filter: brightness(0.98);
            }
            .batch-add-plus {
                width: 34px;
                height: 34px;
                border-radius: 12px;
                border: 1px solid rgba(148, 163, 184, 0.45);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 20px;
                font-weight: 800;
            }
            .batch-add-text {
                font-size: 12px;
                font-weight: 700;
                opacity: 0.85;
            }

            /* ‚úÖ Error Box */
            .batch-errorbox {
                margin-top: 12px;
                padding: 12px;
                border-radius: 14px;
                border: 1px solid rgba(244, 63, 94, 0.25);
                background: rgba(244, 63, 94, 0.06);
            }
            .batch-errorbox-head {
                display: flex;
                justify-content: space-between;
                align-items: baseline;
                gap: 10px;
                margin-bottom: 8px;
            }
            .batch-errorlist {
                margin: 0;
                padding-left: 16px;
                display: grid;
                gap: 6px;
            }
            .batch-errorfile {
                font-weight: 800;
            }
            .batch-errortext {
                opacity: 0.9;
            }

            .muted {
                opacity: 0.82;
            }
        </style>

        {/* ‚úÖ Client JS burada */}
        <script type="module" src={batchClientUrl}></script>

        {/* ‚úÖ TR/EN k√º√ß√ºk text i18n (SSR TR kalsƒ±n, EN'de deƒüi≈ütir) */}
        <script type="module">
            import { i18n } from "/i18n.js";
            import { detectLang } from "/utils/lang.js";

            const lang = detectLang();
            const t = i18n[lang] || i18n.en;

            const set = (id, value) => {
                const el = document.getElementById(id);
                if (el && value != null) el.textContent = value;
            };

            // HTML lang
            document.documentElement.lang = lang;

            // Nav + hero
            set("t-back", t.back ?? (lang === "tr" ? "‚Üê Geri" : "‚Üê Back"));
            set(
                "t-navTools",
                t.toolsHead ?? (lang === "tr" ? "Ara√ßlar" : "Tools"),
            );

            set(
                "t-badge",
                t.badge ??
                    (lang === "tr"
                        ? "√úcretsiz & Sƒ±nƒ±rsƒ±z"
                        : "Free & Unlimited"),
            );

            if (lang === "en") {
                set("t-title", "Batch Image Converter");
                set(
                    "t-sub",
                    "Pick multiple images, convert, and download as a single ZIP. No uploads.",
                );
                set("t-f1", "üóÇÔ∏è Batch");
                set("t-f2", "üîí No uploads");
                set("t-f3", "‚ö° Fast");

                set("t-choose", "Choose files");
                set("idleHint", "or drop them here.");
                set("t-processing", "Processing‚Ä¶");
                set("t-ready", "Ready!");
                set("t-uploadMore", "Upload more?");
                set("t-outFmt", "Output format:");
                set("t-qualityLabel", "Quality:");
                set("t-previewTitle", "Selected files");

                // SEO section EN
                set("t-seoH2", "How does Saku Batch Image Converter work?");
                set(
                    "t-seoLead",
                    "Convert multiple images at once and download them as a single ZIP. Everything runs in your browser‚Äîno uploads.",
                );
                set("t-seoSummary", "Show details");
                set(
                    "t-seoP1",
                    "With Batch Image Converter, you can select multiple images and convert them in one go. All outputs are bundled into a ZIP, saving time.",
                );
                set(
                    "t-seoP2",
                    "HEIC/HEIF (iPhone) and JFIF (WhatsApp) are supported in most cases. Your files are never uploaded‚Äîeverything runs locally on your device.",
                );

                // Error head EN (JS dosyasƒ± da set ediyor ama garanti olsun)
                set("errorHead", "‚ö†Ô∏è Failed files");
            } else {
                // TR breadcrumb
                set("t-bcHome", "Anasayfa");
                set("t-bcHere", "Batch Image Converter");
            }

            // Language active button
            const langBtns = document.querySelectorAll(".lang-btn");
            const current = localStorage.getItem("lang") || lang;
            langBtns.forEach((b) =>
                b.classList.toggle("is-active", b.dataset.lang === current),
            );
            langBtns.forEach((btn) => {
                btn.addEventListener("click", () => {
                    localStorage.setItem("lang", btn.dataset.lang);
                    location.reload();
                });
            });

            // mini hero animation
            const miniHero = document.getElementById("miniHero");
            requestAnimationFrame(() => miniHero?.classList.add("is-entered"));
        </script>
    </div>
</section>
